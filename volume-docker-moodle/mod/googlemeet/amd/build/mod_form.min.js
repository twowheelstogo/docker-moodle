define ("mod_googlemeet/mod_form",["core/notification","core/str","mod_googlemeet/gapi"],function(a,b,c){return{init:function init(d,e,f){var p=["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],q="",r="",s="",t="",u="";b.get_strings([{key:"requirednamefield",component:"mod_googlemeet"},{key:"checkweekdays",component:"mod_googlemeet"},{key:"invalideventendtime",component:"mod_googlemeet"},{key:"invalideventenddate",component:"mod_googlemeet"},{key:"timeahead",component:"mod_googlemeet"}]).done(function(a){q=a[0];r=a[1];s=a[2];t=a[3];u=a[4]}).fail(a.exception);var v=document.getElementById("id_generateurlroom"),w=document.getElementById("id_url"),x=document.getElementById("id_url_viewer"),y=document.getElementById("id_originalname"),z=document.getElementById("id_creatoremail"),A=document.querySelector("#region-main .mform");function g(a,b){var c=new FormData(A),d=c.get(a+"[year]"),e=c.get(a+"[month]"),f=c.get(a+"[day]");e=("0"+e).slice(-2);f=("0"+f).slice(-2);if(b){return d+"-"+e+"-"+f}return d+e+f}function h(){var a=new FormData(A),b=a.get("starthour"),c=a.get("startminute"),d=a.get("endhour"),e=a.get("endminute");b=("0"+b).slice(-2);c=("0"+c).slice(-2);d=("0"+d).slice(-2);e=("0"+e).slice(-2);var f=b+":"+c+":00",h=d+":"+e+":00",j=g("eventdate",!0)+" "+f,k=g("eventenddate",!0)+" "+h,l=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m=new Date(j),n=new Date(k),o=!1;while(m<=n){if(!o){for(var p=0;p<=l.length;p++){var q=l[m.getDay()],r=a.get("days["+l[p]+"]");if(r&&q===l[p]){o=!0;break}}}m=new Date(m.setDate(m.getDate()+1))}return o}function i(){var a=new FormData(A),b=document.getElementById("id_name"),c=document.getElementById("id_error_name");if(0===a.get("name").trim().length){b.classList.add("is-invalid");b.focus();c.innerText="- "+q;c.style.display="block";return!1}else{b.classList.remove("is-invalid");c.innerText="";c.style.display="none"}var d=document.getElementById("id_googlemeet_eventtime_error"),e=3600*a.get("starthour")+60*a.get("startminute"),f=3600*a.get("endhour")+60*a.get("endminute");if(f<e){d.innerText=s;d.style.display="block";document.getElementById("id_endhour").focus();return!1}else{d.innerText="";d.style.display="none"}var i=Math.floor(new Date(g("eventdate",!0)).getTime()/1e3),j=Math.floor(new Date(g("eventenddate",!0)).getTime()/1e3),k=document.getElementById("id_googlemeet_eventenddategroup_error");if(a.get("addmultiply")&&0!==i&&0!==j&&j<i){k.innerText=t;k.style.display="block";document.getElementById("id_eventenddate_day").focus();return!1}else if(a.get("addmultiply")&&1<Math.ceil((j-i)/31536e3)){k.innerText=u;k.style.display="block";document.getElementById("id_eventenddate_day").focus();return!1}else{k.innerText="";k.style.display="none"}if(a.get("addmultiply")){var l=document.getElementById("id_googlemeet_days_error");if(!h()){l.innerText=r;l.style.display="block";document.getElementById("id_days_Mon").focus();return!1}else{l.innerText="";l.style.display="none"}}return!0}function j(){n();if(!i()){return}c.auth2.getAuthInstance().signIn({prompt:"select_account"}).then(function(){o()}).catch()}function k(a){var b=document.getElementById("generateurlroomLoading");if(a){b.style.display="block";v.disabled=!0}else{b.style.display="none";v.disabled=!1}}function l(a){var b=Math.floor(Math.random()*8888)+1111;return a+" ("+b+")"}function m(a){var b=document.getElementById("googlemeetcontentlog"),c=document.createTextNode(a+"\n");b.style.display="block";b.appendChild(c)}function n(){var a=document.getElementById("googlemeetcontentlog");a.style.display="none";a.innerHTML=""}function o(){var a=new FormData(A),b=a.get("starthour"),d=a.get("startminute"),e=a.get("endhour"),h=a.get("endminute");b=("0"+b).slice(-2);d=("0"+d).slice(-2);e=("0"+e).slice(-2);h=("0"+h).slice(-2);var i=b+":"+d+":00",j=e+":"+h+":00",n={dateTime:g("eventdate",!0)+"T"+i,timeZone:f},o={dateTime:g("eventdate",!0)+"T"+j,timeZone:f},p=[];if(a.get("addmultiply")){var q="INTERVAL="+a.get("period"),r="UNTIL="+g("eventenddate",!1)+"T235959Z",s="BYDAY=",t={Sun:"SU",Mon:"MO",Tue:"TU",Wed:"WE",Thu:"TH",Fri:"FR",Sat:"SA"};for(var u in t){if(a.get("days["+u+"]")){s+=t[u]+","}}p=["RRULE:FREQ=WEEKLY;"+q+";"+r+";"+s]}var B=l(a.get("name")),C={summary:B,description:a.get("introeditor[text]"),start:n,end:o,recurrence:p};k(!0);c.client.calendar.events.insert({calendarId:"primary",resource:C}).then(function(a){var b=a.result,d={conferenceData:{createRequest:{requestId:b.id}}};c.client.calendar.events.patch({calendarId:"primary",eventId:b.id,resource:d,sendNotifications:!1,conferenceDataVersion:1}).then(function(a){var b=a.result;v.remove();y.value=B;w.value=b.hangoutLink;x.value=b.hangoutLink;z.value=b.creator.email;document.getElementById("id_googlemeet_generateurlgroup_error").style.display="none";k(!1)}).catch(function(a){m(JSON.stringify(a.result.error,null,2));k(!1)})}).catch(function(a){m(JSON.stringify(a.result.error,null,2));k(!1)})}c.load("client:auth2",function(){c.client.init({apiKey:e,clientId:d,discoveryDocs:p,scope:"https://www.googleapis.com/auth/calendar.events"}).then(function(){v.onclick=j;v.disabled=!1}).catch(function(a){v.disabled=!0;m(JSON.stringify(a,null,2))})})}}});
//# sourceMappingURL=mod_form.min.js.map
